# 智能跌倒检测系统 - 项目结构详解

## 📁 项目整体架构

本项目采用模块化设计，包含桌面版和Web版两套完整应用，支持本地推理和云端部署。

```
Smart-Fall-Detection-Demo/                 # 项目根目录
├── 📄 README.md                          # 项目主文档
├── 📄 项目情况.txt                        # 详细项目介绍
├── 📄 requirements.txt                    # 主要依赖文件
├── 📄 data.yaml                          # YOLO训练数据配置
├── 📄 main.py                            # 核心检测逻辑
├── 📄 gui.py                             # 桌面版GUI界面
├── 📄 train.py                           # 模型训练脚本
├── 📁 models/                            # AI模型存储目录
│   ├── 🎯 best.pt                       # 自训练跌倒检测模型
│   ├── 🎯 yolov8n.pt                    # YOLO基础模型
│   ├── 🎯 yolov8n-pose.pt               # 姿态检测模型
│   └── 🎯 tinyllama-1.1b-chat-v1.0.Q4_K_M.gguf  # LLaMA语言模型
├── 📁 outputs/                           # 检测结果输出
│   └── 🎬 output_*.mp4                   # 处理后的视频文件
├── 📁 static/                            # 静态资源
│   └── 📁 css/                          # 样式文件
├── 📁 __pycache__/                       # Python缓存
└── 📁 web_fall_detection/                # Web版本完整应用
    ├── 📄 README.md                      # Web版说明文档
    ├── 📄 requirements.txt               # Web版依赖
    ├── 📄 app.py                         # Flask主应用
    ├── 🎬 demo.mp4                       # 演示视频
    ├── 📁 static/                        # Web静态资源
    │   ├── 📁 css/                      # 样式文件
    │   │   └── 🎨 style.css             # 主样式表
    │   ├── 📁 js/                       # JavaScript文件
    │   │   └── 📜 main.js               # 主脚本
    │   ├── 📁 uploads/                  # 用户上传文件夹
    │   └── 📁 outputs/                  # Web版输出文件夹
    ├── 📁 templates/                     # HTML模板
    │   ├── 🌐 index.html               # 主页面
    │   ├── 🌐 result.html              # 结果展示页
    │   └── 🌐 test_upload.html         # 测试上传页
    ├── 📁 utils/                        # 核心工具模块
    │   ├── 📄 detector.py               # 检测器核心类
    │   ├── 📄 detector_backup.py        # 检测器备份版本
    │   ├── 📄 analyzer.py               # 结果分析器
    │   ├── 📄 demo.py                   # 演示模式实现
    │   ├── 📄 video_converter.py        # 视频格式转换
    │   └── 📁 __pycache__/              # Python缓存
    └── 📁 __pycache__/                   # Python缓存
```

## 🧩 核心模块功能

### 1. 桌面版组件

#### 📄 `main.py` - 核心检测引擎
- **功能**: 跌倒检测核心算法实现
- **包含**: YOLO检测、姿态分析、LLM集成
- **特点**: 
  - 滑动窗口投票机制
  - 速度和位移分析
  - 实时LLM反馈
  - 多线程处理

#### 📄 `gui.py` - 桌面GUI界面
- **功能**: Tkinter图形用户界面
- **特点**:
  - 文件选择和预览
  - 实时处理进度
  - 弹窗显示LLM分析
  - 简洁易用的操作流程

#### 📄 `train.py` - 模型训练脚本
- **功能**: YOLOv8模型训练
- **支持**: 
  - 自定义数据集训练
  - 断点续训
  - 超参数调整
  - 训练过程监控

### 2. Web版组件

#### 📄 `app.py` - Flask Web应用
- **功能**: Web服务主入口
- **特点**:
  - RESTful API设计
  - 多任务并发处理
  - 性能监控
  - 错误处理和恢复
  - 演示模式支持

#### 📁 `utils/` - 核心工具模块

##### 📄 `detector.py` - 检测器核心类
- **功能**: 封装检测逻辑为面向对象接口
- **优化**:
  - GPU加速支持
  - 跳帧检测优化
  - 内存管理
  - 并发安全

##### 📄 `analyzer.py` - 结果分析器
- **功能**: 统计分析和可视化
- **输出**:
  - 跌倒事件统计
  - 时间分布分析
  - 置信度评估
  - 风险等级评估

##### 📄 `demo.py` - 演示模式
- **功能**: 无模型文件的演示功能
- **特点**:
  - 模拟检测结果
  - 保持界面完整性
  - 降低使用门槛

##### 📄 `video_converter.py` - 视频处理
- **功能**: 视频格式转换和优化
- **支持**:
  - 多种视频格式
  - 压缩和质量控制
  - 浏览器兼容性优化

### 3. AI模型组件

#### 🎯 `best.pt` - 跌倒检测模型
- **类型**: 自训练YOLOv8模型
- **功能**: 识别正常和跌倒状态
- **类别**: 0-正常, 1-跌倒
- **特点**: 针对老年人动作优化

#### 🎯 `yolov8n-pose.pt` - 姿态检测模型
- **类型**: YOLOv8姿态估计模型
- **功能**: 人体关键点检测
- **用途**: 可视化增强，非检测依赖

#### 🎯 `tinyllama-1.1b-chat-v1.0.Q4_K_M.gguf` - 语言模型
- **类型**: 量化LLaMA模型
- **功能**: 生成护理建议和分析
- **特点**: 本地推理，隐私保护

## 🔄 数据流程

### 桌面版流程
```
用户选择视频 → GUI界面 → main.py检测 → 实时显示 → LLM分析 → 弹窗反馈
```

### Web版流程
```
用户上传视频 → Flask接收 → detector.py处理 → analyzer.py分析 → 结果页面展示
```

## 💾 文件存储结构

### 输入文件
- **视频文件**: 支持mp4, avi, mov格式
- **模型文件**: .pt和.gguf格式
- **配置文件**: YAML格式

### 输出文件
- **处理后视频**: 带检测标注的mp4文件
- **分析报告**: JSON格式的检测结果
- **日志文件**: 系统运行日志

## 🔧 配置文件说明

### `data.yaml` - 训练数据配置
```yaml
path: .                    # 数据集根路径
train: images/train        # 训练图片路径
val: images/val           # 验证图片路径
nc: 2                     # 类别数量
names: ["normal", "fall"] # 类别名称
```

### `requirements.txt` - 依赖管理
- **分层设计**: 核心依赖 + 可选依赖
- **版本控制**: 指定最小版本要求
- **平台兼容**: 支持Windows/Linux/Mac

## 📊 性能优化策略

### 1. 检测优化
- **跳帧处理**: 可配置跳帧间隔
- **GPU加速**: 自动检测和使用GPU
- **批处理**: 提高处理效率

### 2. 内存优化
- **流式处理**: 避免全量加载
- **缓存管理**: 智能清理机制
- **资源回收**: 及时释放资源

### 3. 并发优化
- **多线程**: GUI不阻塞
- **任务队列**: Web版任务管理
- **进度反馈**: 实时状态更新

## 🔒 安全与隐私

### 隐私保护
- **本地处理**: 视频不上传云端
- **模型本地化**: AI推理在本地完成
- **数据清理**: 自动清理临时文件

### 安全措施
- **文件类型检查**: 防止恶意文件上传
- **路径安全**: 防止路径遍历攻击
- **资源限制**: 防止资源耗尽

## 🚀 部署建议

### 开发环境
- Python 3.8+
- 8GB+ 内存
- 可选GPU支持

### 生产环境
- **Web版**: 使用Gunicorn + Nginx
- **容器化**: Docker部署支持
- **负载均衡**: 多实例部署

### 扩展性
- **API接口**: 支持第三方集成
- **插件机制**: 可扩展新功能
- **配置化**: 灵活的参数调整

这个项目结构设计注重模块化、可扩展性和用户体验，既适合研究使用，也支持实际部署应用。
